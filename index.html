<!DOCTYPE html>
<html lang="de" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lunchinator - Kaserne Timeout Men√º</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#111827">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Lunchinator">
    
    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicons -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxyZWN0IHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiByeD0iOTYiIGZpbGw9IiMzYjgyZjYiLz48Y2lyY2xlIGN4PSIyNTYiIGN5PSIyNTYiIHI9IjE4MCIgZmlsbD0iI2Y5ZmFmYiIgc3Ryb2tlPSIjMWYyOTM3IiBzdHJva2Utd2lkdGg9IjgiLz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxODAsIDIwMCkiPjxyZWN0IHg9IjE1IiB5PSI4MCIgd2lkdGg9IjEyIiBoZWlnaHQ9IjEyMCIgcng9IjYiIGZpbGw9IiMxZjI5MzciLz48cmVjdCB4PSI4IiB5PSI1MCIgd2lkdGg9IjYiIGhlaWdodD0iNDAiIHJ4PSIzIiBmaWxsPSIjMWYyOTM3Ii8+PHJlY3QgeD0iMTYiIHk9IjUwIiB3aWR0aD0iNiIgaGVpZ2h0PSI0MCIgcng9IjMiIGZpbGw9IiMxZjI5MzciLz48cmVjdCB4PSIyNCIgeT0iNTAiIHdpZHRoPSI2IiBoZWlnaHQ9IjQwIiByeD0iMyIgZmlsbD0iIzFmMjkzNyIvPjwvZz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyOTAsIDIwMCkiPjxyZWN0IHg9IjE1IiB5PSI4MCIgd2lkdGg9IjEyIiBoZWlnaHQ9IjEyMCIgcng9IjYiIGZpbGw9IiMxZjI5MzciLz48cGF0aCBkPSJNMTUgNTAgTDI3IDUwIEwyNyA4NSBMMTUgODUgWiIgZmlsbD0iIzk0YTNiOCIvPjxwYXRoIGQ9Ik0yMSAzMCBMMjcgNTAgTDE1IDUwIFoiIGZpbGw9IiNjYmQ1ZTEiLz48L2c+PGVsbGlwc2UgY3g9IjI1NiIgY3k9IjI0MCIgcng9IjYwIiByeT0iMjUiIGZpbGw9IiMxMGI5ODEiLz48ZWxsaXBzZSBjeD0iMjQwIiBjeT0iMjUwIiByeD0iMzUiIHJ5PSIxNSIgZmlsbD0iIzM0ZDM5OSIvPjxlbGxpcHNlIGN4PSIyNzUiIGN5PSIyNTUiIHJ4PSIyNSIgcnk9IjEyIiBmaWxsPSIjZjU5ZTBiIi8+PC9zdmc+">
    <link rel="icon" type="image/png" sizes="16x16" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxyZWN0IHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiByeD0iOTYiIGZpbGw9IiMzYjgyZjYiLz48Y2lyY2xlIGN4PSIyNTYiIGN5PSIyNTYiIHI9IjE4MCIgZmlsbD0iI2Y5ZmFmYiIgc3Ryb2tlPSIjMWYyOTM3IiBzdHJva2Utd2lkdGg9IjgiLz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxODAsIDIwMCkiPjxyZWN0IHg9IjE1IiB5PSI4MCIgd2lkdGg9IjEyIiBoZWlnaHQ9IjEyMCIgcng9IjYiIGZpbGw9IiMxZjI5MzciLz48cmVjdCB4PSI4IiB5PSI1MCIgd2lkdGg9IjYiIGhlaWdodD0iNDAiIHJ4PSIzIiBmaWxsPSIjMWYyOTM3Ii8+PHJlY3QgeD0iMTYiIHk9IjUwIiB3aWR0aD0iNiIgaGVpZ2h0PSI0MCIgcng9IjMiIGZpbGw9IiMxZjI5MzciLz48cmVjdCB4PSIyNCIgeT0iNTAiIHdpZHRoPSI2IiBoZWlnaHQ9IjQwIiByeD0iMyIgZmlsbD0iIzFmMjkzNyIvPjwvZz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyOTAsIDIwMCkiPjxyZWN0IHg9IjE1IiB5PSI4MCIgd2lkdGg9IjEyIiBoZWlnaHQ9IjEyMCIgcng9IjYiIGZpbGw9IiMxZjI5MzciLz48cGF0aCBkPSJNMTUgNTAgTDI3IDUwIEwyNyA4NSBMMTUgODUgWiIgZmlsbD0iIzk0YTNiOCIvPjxwYXRoIGQ9Ik0yMSAzMCBMMjcgNTAgTDE1IDUwIFoiIGZpbGw9IiNjYmQ1ZTEiLz48L2c+PGVsbGlwc2UgY3g9IjI1NiIgY3k9IjI0MCIgcng9IjYwIiByeT0iMjUiIGZpbGw9IiMxMGI5ODEiLz48ZWxsaXBzZSBjeD0iMjQwIiBjeT0iMjUwIiByeD0iMzUiIHJ5PSIxNSIgZmlsbD0iIzM0ZDM5OSIvPjxlbGxpcHNlIGN4PSIyNzUiIGN5PSIyNTUiIHJ4PSIyNSIgcnk9IjEyIiBmaWxsPSIjZjU5ZTBiIi8+PC9zdmc+">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCI+PHJlY3Qgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiIHJ4PSI5NiIgZmlsbD0iIzNiODJmNiIvPjxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgcj0iMTgwIiBmaWxsPSIjZjlmYWZiIiBzdHJva2U9IiMxZjI5MzciIHN0cm9rZS13aWR0aD0iOCIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE4MCwgMjAwKSI+PHJlY3QgeD0iMTUiIHk9IjgwIiB3aWR0aD0iMTIiIGhlaWdodD0iMTIwIiByeD0iNiIgZmlsbD0iIzFmMjkzNyIvPjxyZWN0IHg9IjgiIHk9IjUwIiB3aWR0aD0iNiIgaGVpZ2h0PSI0MCIgcng9IjMiIGZpbGw9IiMxZjI5MzciLz48cmVjdCB4PSIxNiIgeT0iNTAiIHdpZHRoPSI2IiBoZWlnaHQ9IjQwIiByeD0iMyIgZmlsbD0iIzFmMjkzNyIvPjxyZWN0IHg9IjI0IiB5PSI1MCIgd2lkdGg9IjYiIGhlaWdodD0iNDAiIHJ4PSIzIiBmaWxsPSIjMWYyOTM3Ii8+PC9nPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI5MCwgMjAwKSI+PHJlY3QgeD0iMTUiIHk9IjgwIiB3aWR0aD0iMTIiIGhlaWdodD0iMTIwIiByeD0iNiIgZmlsbD0iIzFmMjkzNyIvPjxwYXRoIGQ9Ik0xNSA1MCBMMjcgNTAgTDI3IDg1IEwxNSA4NSBaIiBmaWxsPSIjOTRhM2I4Ii8+PHBhdGggZD0iTTIxIDMwIEwyNyA1MCBMMTUgNTAgWiIgZmlsbD0iI2NiZDVlMSIvPjwvZz48ZWxsaXBzZSBjeD0iMjU2IiBjeT0iMjQwIiByeD0iNjAiIHJ5PSIyNSIgZmlsbD0iIzEwYjk4MSIvPjxlbGxpcHNlIGN4PSIyNDAiIGN5PSIyNTAiIHJ4PSIzNSIgcnk9IjE1IiBmaWxsPSIjMzRkMzk5Ii8+PGVsbGlwc2UgY3g9IjI3NSIgY3k9IjI1NSIgcng9IjI1IiByeT0iMTIiIGZpbGw9IiNmNTllMGIiLz48L3N2Zz4=">
    <link rel="apple-touch-icon" sizes="152x152" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiB3aWR0aD0iMTUyIiBoZWlnaHQ9IjE1MiI+PHJlY3Qgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiIHJ4PSI5NiIgZmlsbD0iIzNiODJmNiIvPjxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgcj0iMTgwIiBmaWxsPSIjZjlmYWZiIiBzdHJva2U9IiMxZjI5MzciIHN0cm9rZS13aWR0aD0iOCIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE4MCwgMjAwKSI+PHJlY3QgeD0iMTUiIHk9IjgwIiB3aWR0aD0iMTIiIGhlaWdodD0iMTIwIiByeD0iNiIgZmlsbD0iIzFmMjkzNyIvPjxyZWN0IHg9IjgiIHk9IjUwIiB3aWR0aD0iNiIgaGVpZ2h0PSI0MCIgcng9IjMiIGZpbGw9IiMxZjI5MzciLz48cmVjdCB4PSIxNiIgeT0iNTAiIHdpZHRoPSI2IiBoZWlnaHQ9IjQwIiByeD0iMyIgZmlsbD0iIzFmMjkzNyIvPjxyZWN0IHg9IjI0IiB5PSI1MCIgd2lkdGg9IjYiIGhlaWdodD0iNDAiIHJ4PSIzIiBmaWxsPSIjMWYyOTM3Ii8+PC9nPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI5MCwgMjAwKSI+PHJlY3QgeD0iMTUiIHk9IjgwIiB3aWR0aD0iMTIiIGhlaWdodD0iMTIwIiByeD0iNiIgZmlsbD0iIzFmMjkzNyIvPjxwYXRoIGQ9Ik0xNSA1MCBMMjcgNTAgTDI3IDg1IEwxNSA4NSBaIiBmaWxsPSIjOTRhM2I4Ii8+PHBhdGggZD0iTTIxIDMwIEwyNyA1MCBMMTUgNTAgWiIgZmlsbD0iI2NiZDVlMSIvPjwvZz48ZWxsaXBzZSBjeD0iMjU2IiBjeT0iMjQwIiByeD0iNjAiIHJ5PSIyNSIgZmlsbD0iIzEwYjk4MSIvPjxlbGxpcHNlIGN4PSIyNDAiIGN5PSIyNTAiIHJ4PSIzNSIgcnk9IjE1IiBmaWxsPSIjMzRkMzk5Ii8+PGVsbGlwc2UgY3g9IjI3NSIgY3k9IjI1NSIgcng9IjI1IiByeT0iMTIiIGZpbGw9IiNmNTllMGIiLz48L3N2Zz4=">
    <link rel="apple-touch-icon" sizes="120x120" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCI+PHJlY3Qgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiIHJ4PSI5NiIgZmlsbD0iIzNiODJmNiIvPjxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgcj0iMTgwIiBmaWxsPSIjZjlmYWZiIiBzdHJva2U9IiMxZjI5MzciIHN0cm9rZS13aWR0aD0iOCIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE4MCwgMjAwKSI+PHJlY3QgeD0iMTUiIHk9IjgwIiB3aWR0aD0iMTIiIGhlaWdodD0iMTIwIiByeD0iNiIgZmlsbD0iIzFmMjkzNyIvPjxyZWN0IHg9IjgiIHk9IjUwIiB3aWR0aD0iNiIgaGVpZ2h0PSI0MCIgcng9IjMiIGZpbGw9IiMxZjI5MzciLz48cmVjdCB4PSIxNiIgeT0iNTAiIHdpZHRoPSI2IiBoZWlnaHQ9IjQwIiByeD0iMyIgZmlsbD0iIzFmMjkzNyIvPjxyZWN0IHg9IjI0IiB5PSI1MCIgd2lkdGg9IjYiIGhlaWdodD0iNDAiIHJ4PSIzIiBmaWxsPSIjMWYyOTM3Ii8+PC9nPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI5MCwgMjAwKSI+PHJlY3QgeD0iMTUiIHk9IjgwIiB3aWR0aD0iMTIiIGhlaWdodD0iMTIwIiByeD0iNiIgZmlsbD0iIzFmMjkzNyIvPjxwYXRoIGQ9Ik0xNSA1MCBMMjcgNTAgTDI3IDg1IEwxNSA4NSBaIiBmaWxsPSIjOTRhM2I4Ii8+PHBhdGggZD0iTTIxIDMwIEwyNyA1MCBMMTUgNTAgWiIgZmlsbD0iI2NiZDVlMSIvPjwvZz48ZWxsaXBzZSBjeD0iMjU2IiBjeT0iMjQwIiByeD0iNjAiIHJ5PSIyNSIgZmlsbD0iIzEwYjk4MSIvPjxlbGxpcHNlIGN4PSIyNDAiIGN5PSIyNTAiIHJ4PSIzNSIgcnk9IjE1IiBmaWxsPSIjMzRkMzk5Ii8+PGVsbGlwc2UgY3g9IjI3NSIgY3k9IjI1NSIgcng9IjI1IiByeT0iMTIiIGZpbGw9IiNmNTllMGIiLz48L3N2Zz4=">
    
    <!-- Microsoft Tiles -->
    <meta name="msapplication-TileColor" content="#3b82f6">
    <meta name="msapplication-TileImage" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiB3aWR0aD0iMTQ0IiBoZWlnaHQ9IjE0NCI+PHJlY3Qgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiIHJ4PSI5NiIgZmlsbD0iIzNiODJmNiIvPjxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgcj0iMTgwIiBmaWxsPSIjZjlmYWZiIiBzdHJva2U9IiMxZjI5MzciIHN0cm9rZS13aWR0aD0iOCIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE4MCwgMjAwKSI+PHJlY3QgeD0iMTUiIHk9IjgwIiB3aWR0aD0iMTIiIGhlaWdodD0iMTIwIiByeD0iNiIgZmlsbD0iIzFmMjkzNyIvPjxyZWN0IHg9IjgiIHk9IjUwIiB3aWR0aD0iNiIgaGVpZ2h0PSI0MCIgcng9IjMiIGZpbGw9IiMxZjI5MzciLz48cmVjdCB4PSIxNiIgeT0iNTAiIHdpZHRoPSI2IiBoZWlnaHQ9IjQwIiByeD0iMyIgZmlsbD0iIzFmMjkzNyIvPjxyZWN0IHg9IjI0IiB5PSI1MCIgd2lkdGg9IjYiIGhlaWdodD0iNDAiIHJ4PSIzIiBmaWxsPSIjMWYyOTM3Ii8+PC9nPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI5MCwgMjAwKSI+PHJlY3QgeD0iMTUiIHk9IjgwIiB3aWR0aD0iMTIiIGhlaWdodD0iMTIwIiByeD0iNiIgZmlsbD0iIzFmMjkzNyIvPjxwYXRoIGQ9Ik0xNSA1MCBMMjcgNTAgTDI3IDg1IEwxNSA4NSBaIiBmaWxsPSIjOTRhM2I4Ii8+PHBhdGggZD0iTTIxIDMwIEwyNyA1MCBMMTUgNTAgWiIgZmlsbD0iI2NiZDVlMSIvPjwvZz48ZWxsaXBzZSBjeD0iMjU2IiBjeT0iMjQwIiByeD0iNjAiIHJ5PSIyNSIgZmlsbD0iIzEwYjk4MSIvPjxlbGxpcHNlIGN4PSIyNDAiIGN5PSIyNTAiIHJ4PSIzNSIgcnk9IjE1IiBmaWxsPSIjMzRkMzk5Ii8+PGVsbGlwc2UgY3g9IjI3NSIgY3k9IjI1NSIgcng9IjI1IiByeT0iMTIiIGZpbGw9IiNmNTllMGIiLz48L3N2Zz4=">
    
    <style>
        :root {
            --bg-color: #111827;
            --text-color: #f9fafb;
            --card-bg: #1f2937;
            --border-color: #374151;
            --primary-color: #3b82f6;
            --secondary-color: #9ca3af;
            --success-color: #34d399;
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.3), 0 1px 2px -1px rgb(0 0 0 / 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .theme-toggle {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            background: var(--border-color);
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--secondary-color);
        }

        .error {
            background: #3f1f1f;
            color: #fca5a5;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border: 1px solid #7f1d1d;
        }

        .menu-grid {
            display: grid;
            gap: 1.5rem;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            padding: 1rem 0;
        }

        .menu-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .menu-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }

        .menu-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .menu-description {
            color: var(--secondary-color);
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .menu-price {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--success-color);
        }

        .menu-category {
            display: inline-block;
            background: var(--primary-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .date-selector {
            display: none;
        }

        .refresh-btn {
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 0.5rem;
            }

            .menu-grid {
                grid-template-columns: 1fr;
            }
        }

        .spinner {
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .install-prompt {
            background: var(--primary-color);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
            justify-content: space-between;
            align-items: center;
        }

        .install-btn {
            background: white;
            color: var(--primary-color);
            border: none;
            border-radius: 6px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-weight: 600;
        }

        .dismiss-btn {
            background: transparent;
            color: white;
            border: 1px solid white;
            border-radius: 6px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            margin-left: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="install-prompt" id="installPrompt">
            <span>üì± App installieren f√ºr eine bessere Erfahrung</span>
            <div>
                <button class="install-btn" id="installBtn">Installieren</button>
                <button class="dismiss-btn" id="dismissBtn">Sp√§ter</button>
            </div>
        </div>

        <div id="content">
            <div class="loading">
                <div class="spinner"></div>
                <p>Lade Men√ºdaten...</p>
            </div>
        </div>
    </div>

    <script>
        class Lunchinator {
            constructor() {
                this.apiBase = 'https://clients.eurest.ch/kaserne/de/Timeout';
                this.currentDate = new Date();
                this.init();
            }

            async init() {
                this.setupPWA();
                await this.loadMenu();
            }

            async loadMenu() {
                const content = document.getElementById('content');
                
                content.innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Lade Men√ºdaten...</p>
                    </div>
                `;

                try {
                    // Try different API endpoints that might exist
                    const possibleEndpoints = [
                        '/api/menu',
                        '/api/meals',
                        '/api/daily-menu',
                        '/menu.json',
                        '/api/v1/menu',
                        '/api/restaurants/kaserne',
                        '/api/menus/today'
                    ];

                    let menuData = null;

                    // Try to fetch from different endpoints
                    for (const endpoint of possibleEndpoints) {
                        try {
                            const response = await fetch(`${this.apiBase}${endpoint}`);
                            if (response.ok) {
                                const data = await response.json();
                                if (data && (Array.isArray(data) || data.menus || data.meals)) {
                                    menuData = Array.isArray(data) ? data : (data.menus || data.meals || [data]);
                                    break;
                                }
                            }
                        } catch (e) {
                            console.log(`Endpoint ${endpoint} failed:`, e);
                        }
                    }

                    // If no API endpoint works, try to scrape the HTML
                    if (!menuData) {
                        menuData = await this.scrapeMenuFromHTML();
                    }

                    if (menuData && menuData.length > 0) {
                        this.renderMenu(menuData);
                    } else {
                        this.showError('Keine Men√ºdaten verf√ºgbar.');
                    }

                } catch (error) {
                    console.error('Error loading menu:', error);
                    this.showError('Fehler beim Laden der Men√ºdaten.');
                }
            }

            async scrapeMenuFromHTML() {
                try {
                    const response = await fetch(this.apiBase, {
                        headers: {
                            'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
                            'Accept-Language': 'de,en;q=0.5',
                            'Cache-Control': 'no-cache'
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                    
                    const html = await response.text();
                    console.log('Fetched HTML length:', html.length);
                    
                    // First try direct text extraction for Eurest format
                    let menuItems = this.extractMenuFromText(html);
                    
                    if (menuItems.length === 0) {
                        // If text extraction fails, try DOM parsing
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(html, 'text/html');
                        menuItems = this.extractMenuFromDOM(doc);
                    }

                    // Remove duplicates and filter valid items
                    const uniqueItems = this.removeDuplicates(menuItems);
                    console.log(`Final menu items: ${uniqueItems.length}`);
                    
                    return uniqueItems.length > 0 ? uniqueItems : this.createSampleMenu();
                    
                } catch (error) {
                    console.error('Error scraping HTML:', error);
                    return this.createSampleMenu();
                }
            }

            extractMenuFromDOM(doc) {
                const menuItems = [];
                
                // More comprehensive selectors for Eurest websites
                const selectors = [
                    // Common Eurest selectors
                    '.meal-card',
                    '.menu-card',
                    '.dish-card',
                    '.meal-item',
                    '.menu-item',
                    '.dish-item',
                    '.food-card',
                    '.restaurant-meal',
                    '[data-meal]',
                    '[data-dish]',
                    '[data-menu-item]',
                    // Generic content selectors
                    '.card',
                    '.item',
                    '.product',
                    // Structure-based selectors
                    'article',
                    '.content-item',
                    '.list-item',
                    // Broader selectors
                    'div[class*="menu"]',
                    'div[class*="meal"]',
                    'div[class*="dish"]',
                    'section',
                    'li'
                ];

                console.log('Trying DOM selectors...');
                
                for (const selector of selectors) {
                    const elements = doc.querySelectorAll(selector);
                    console.log(`Selector "${selector}" found ${elements.length} elements`);
                    
                    if (elements.length > 0) {
                        elements.forEach((el, index) => {
                            // Try multiple ways to extract title
                            const title = this.extractText(el, [
                                'h1, h2, h3, h4, h5, h6',
                                '.title', '.name', '.dish-name', '.meal-name',
                                '.food-title', '.product-name',
                                '[data-title]', '[data-name]',
                                '.card-title', '.item-title'
                            ]);
                            
                            // Try multiple ways to extract description
                            const description = this.extractText(el, [
                                'p', '.description', '.ingredients', '.details',
                                '.dish-description', '.meal-description',
                                '.content', '.info', '.text',
                                '[data-description]', '[data-ingredients]'
                            ]);
                            
                            // Try multiple ways to extract price
                            const price = this.extractText(el, [
                                '.price', '.cost', '.amount',
                                '.price-value', '.meal-price',
                                '[data-price]', '[data-cost]',
                                'span[class*="price"]', 'div[class*="price"]'
                            ]);
                            
                            // Extract category if available
                            const category = this.extractText(el, [
                                '.category', '.type', '.meal-type',
                                '[data-category]', '[data-type]'
                            ]);
                            
                            // Also check element text content for patterns
                            const elementText = el.textContent || '';
                            const priceInText = elementText.match(/CHF\s*\d+[.,]\d{2}/);
                            const categoryInText = elementText.match(/(Menu|Vegi|Hit)/i);
                            
                            const finalTitle = title || this.extractTitleFromText(elementText);
                            const finalPrice = price || (priceInText ? priceInText[0] : '');
                            const finalCategory = category || (categoryInText ? categoryInText[0] : '');
                            
                            console.log(`Element ${index}:`, { 
                                title: finalTitle, 
                                description, 
                                price: finalPrice, 
                                category: finalCategory 
                            });
                            
                            if (finalTitle && finalTitle.length > 3) {
                                // Filter out breakfast and dessert items
                                if (this.shouldIncludeMenuItem(finalTitle, description, finalCategory)) {
                                    menuItems.push({
                                        title: this.cleanText(finalTitle),
                                        description: this.cleanText(description) || '',
                                        price: this.cleanText(finalPrice) || '',
                                        category: this.determineCategory(finalTitle, description, finalCategory, el)
                                    });
                                }
                            }
                        });
                        
                        // Don't break immediately, collect from multiple selectors if needed
                        if (menuItems.length >= 3) {
                            console.log(`Found ${menuItems.length} menu items with selector "${selector}"`);
                            break;
                        }
                    }
                }
                
                return menuItems;
            }

            extractTitleFromText(text) {
                // Extract potential food title from text
                const lines = text.split('\n').map(l => l.trim()).filter(l => l.length > 0);
                
                for (const line of lines) {
                    // Look for lines that could be food titles
                    if (line.length > 5 && line.length < 100 && 
                        !line.includes('CHF') && 
                        !line.match(/^\d+/) &&
                        !line.toLowerCase().includes('dessert') &&
                        !line.toLowerCase().includes('fr√ºhst√ºck')) {
                        return line;
                    }
                }
                
                return '';
            }

            shouldIncludeMenuItem(title, description, category) {
                const combinedText = `${title} ${description} ${category}`.toLowerCase();
                
                // Filter out breakfast items
                const breakfastKeywords = [
                    'fr√ºhst√ºck', 'breakfast', 'kaffee', 'tee', 'orangensaft',
                    'butter', 'konfit√ºre', 'brot', 'cornflakes', 'fleisch- und k√§seplatte',
                    'croissant', 'gipfeli', 'm√ºsli', 'joghurt', 'marmelade'
                ];
                
                // Filter out dessert items
                const dessertKeywords = [
                    'dessert', 'tagesdessert', 'nachspeise', 'kuchen', 'torte',
                    'eis', 'tiramisu', 'mousse', 'pudding', 'cr√®me', 'fr√ºchte',
                    's√º√üspeise', 's√ºssspeise'
                ];
                
                // Check if item contains breakfast keywords
                for (const keyword of breakfastKeywords) {
                    if (combinedText.includes(keyword)) {
                        console.log(`Filtering out breakfast item: ${title}`);
                        return false;
                    }
                }
                
                // Check if item contains dessert keywords
                for (const keyword of dessertKeywords) {
                    if (combinedText.includes(keyword)) {
                        console.log(`Filtering out dessert item: ${title}`);
                        return false;
                    }
                }
                
                return true;
            }

            determineCategory(title, description, category, element) {
                const combinedText = `${title} ${description} ${category}`.toLowerCase();
                
                // Check the element and its siblings for category indicators
                const elementText = element.textContent.toLowerCase();
                
                // Look for Eurest-specific category markers
                if (elementText.includes('vegi') || combinedText.includes('vegetarisch')) {
                    return 'Vegi';
                }
                
                if (elementText.includes('hit') || combinedText.includes('hit')) {
                    return 'Hit';
                }
                
                if (elementText.includes('menu') || combinedText.includes('menu')) {
                    return 'Menu';
                }
                
                // Check for vegetarian indicators
                const vegiKeywords = [
                    'vegetarisch', 'vegan', 'veggie', 'pasta', 'tortellini',
                    'salat', 'gem√ºse', 'ricotta', 'spinat', 'tofu'
                ];
                
                for (const keyword of vegiKeywords) {
                    if (combinedText.includes(keyword)) {
                        return 'Vegi';
                    }
                }
                
                // Check for meat dishes (Hit category indicators)
                const meatKeywords = [
                    'schnitzel', 'schweins', 'rind', 'fleisch', 'h√§hnchen',
                    'poulet', 'lamm', 'kalb', 'steak'
                ];
                
                for (const keyword of meatKeywords) {
                    if (combinedText.includes(keyword)) {
                        return 'Hit';
                    }
                }
                
                // Check for fish dishes
                const fishKeywords = [
                    'lachs', 'fisch', 'thunfisch', 'forelle', 'scholle',
                    'kabeljau', 'meeresfr√ºchte'
                ];
                
                for (const keyword of fishKeywords) {
                    if (combinedText.includes(keyword)) {
                        return 'Menu';
                    }
                }
                
                // Default category
                return 'Menu';
            }

            extractMenuFromText(html) {
                // Remove HTML tags and extract potential menu items
                const text = html.replace(/<[^>]*>/g, ' ').replace(/\s+/g, ' ');
                
                // Look for the specific Eurest menu structure
                const menuItems = [];
                
                // Pattern for Eurest menu items with categories
                const eurestPattern = /(.*?)\n(.*?)\n(Menu|Vegi|Hit)\nCHF\s*(\d+[.,]\d{2})/gi;
                let match;
                
                while ((match = eurestPattern.exec(text)) !== null) {
                    const [, title, description, category, price] = match;
                    
                    if (title && this.shouldIncludeMenuItem(title, description, category)) {
                        menuItems.push({
                            title: this.cleanText(title),
                            description: this.cleanText(description),
                            price: `CHF ${price}`,
                            category: category
                        });
                    }
                }
                
                // If no structured pattern found, try general food patterns
                if (menuItems.length === 0) {
                    const generalPatterns = [
                        // Pattern: Food name followed by price
                        /([A-Z√Ñ√ñ√ú][a-z√§√∂√º√ü\s-]+(?:schnitzel|pasta|salat|lachs|fisch|fleisch|h√§hnchen|rind|schwein))[^.]*CHF\s*(\d+[.,]\d{2})/gi,
                        // Pattern: Price followed by food name
                        /CHF\s*(\d+[.,]\d{2})[^A-Z√Ñ√ñ√ú]*([A-Z√Ñ√ñ√ú][a-z√§√∂√º√ü\s-]{10,50})/gi
                    ];
                    
                    for (const pattern of generalPatterns) {
                        const matches = text.matchAll(pattern);
                        for (const match of matches) {
                            const title = match[2] || match[1];
                            const price = match[1] || match[2];
                            
                            if (title && title.length > 5 && this.shouldIncludeMenuItem(title, '', '')) {
                                menuItems.push({
                                    title: this.cleanText(title),
                                    description: '',
                                    price: price.includes('CHF') ? price : `CHF ${price}`,
                                    category: this.determineCategory(title, '', '', { textContent: title })
                                });
                            }
                        }
                    }
                }
                
                return this.removeDuplicates(menuItems).slice(0, 6);
            }

            extractText(element, selectors) {
                for (const selector of selectors) {
                    const found = element.querySelector(selector);
                    if (found && found.textContent && found.textContent.trim()) {
                        return found.textContent.trim();
                    }
                }
                return '';
            }

            extractMenuFromText(html) {
                const menuItems = [];
                
                // Remove HTML tags but keep structure
                const text = html.replace(/<script[^>]*>.*?<\/script>/gis, '')
                              .replace(/<style[^>]*>.*?<\/style>/gis, '')
                              .replace(/<[^>]*>/g, '\n')
                              .replace(/\s+/g, ' ')
                              .replace(/\n+/g, '\n');
                
                console.log('Processing text for menu extraction...');
                
                // Split text into lines for easier processing
                const lines = text.split('\n').map(line => line.trim()).filter(line => line.length > 0);
                
                // Look for the specific pattern on the Eurest website
                // Based on the example: Title, Description, Category, Price
                for (let i = 0; i < lines.length - 3; i++) {
                    const title = lines[i];
                    const description = lines[i + 1];
                    const category = lines[i + 2];
                    const price = lines[i + 3];
                    
                    // Check if this looks like a menu item
                    if (this.isValidMenuPattern(title, description, category, price)) {
                        if (this.shouldIncludeMenuItem(title, description, category)) {
                            menuItems.push({
                                title: this.cleanText(title),
                                description: this.cleanText(description),
                                price: this.cleanText(price),
                                category: this.cleanText(category)
                            });
                            console.log(`Found menu item: ${title} - ${category} - ${price}`);
                        }
                    }
                }
                
                // If no structured pattern found, try alternative patterns
                if (menuItems.length === 0) {
                    console.log('No structured pattern found, trying alternative extraction...');
                    
                    // Look for food items with CHF prices
                    const pricePattern = /CHF\s*\d+[.,]\d{2}/g;
                    const priceMatches = [];
                    let match;
                    
                    while ((match = pricePattern.exec(text)) !== null) {
                        const startIndex = Math.max(0, match.index - 200);
                        const endIndex = Math.min(text.length, match.index + match[0].length + 50);
                        const context = text.substring(startIndex, endIndex);
                        
                        // Extract potential title from context before price
                        const beforePrice = text.substring(Math.max(0, match.index - 100), match.index);
                        const words = beforePrice.split(/\s+/).filter(w => w.length > 2);
                        
                        if (words.length >= 2) {
                            const title = words.slice(-4).join(' '); // Take last few words as title
                            const price = match[0];
                            
                            if (title.length > 5 && this.shouldIncludeMenuItem(title, '', '')) {
                                menuItems.push({
                                    title: this.cleanText(title),
                                    description: '',
                                    price: this.cleanText(price),
                                    category: this.determineCategory(title, '', '', { textContent: title })
                                });
                            }
                        }
                    }
                }
                
                return this.removeDuplicates(menuItems).slice(0, 6);
            }

            isValidMenuPattern(title, description, category, price) {
                // Check if this looks like a valid menu item pattern
                if (!title || !category || !price) return false;
                
                // Title should be reasonable length and contain food-related words
                if (title.length < 3 || title.length > 100) return false;
                
                // Category should be one of the expected categories
                const validCategories = ['Menu', 'Vegi', 'Hit', 'Fr√ºhst√ºck', 'Dessert'];
                const categoryMatch = validCategories.some(cat => 
                    category.toLowerCase().includes(cat.toLowerCase())
                );
                
                // Price should contain CHF
                const priceMatch = price.includes('CHF') && /\d+[.,]\d{2}/.test(price);
                
                // Description should be reasonable (optional)
                const descriptionValid = !description || 
                    (description.length >= 3 && description.length <= 200);
                
                return categoryMatch && priceMatch && descriptionValid;
            }

            removeDuplicates(items) {
                const seen = new Set();
                return items.filter(item => {
                    // Create a more specific key that includes category to avoid over-filtering
                    const key = `${item.title.toLowerCase()}-${item.category}`;
                    if (seen.has(key)) {
                        return false;
                    }
                    seen.add(key);
                    return true;
                });
            }

            createSampleMenu() {
                // Create sample menu data when API is not available
                const today = new Date();
                const dayOfWeek = today.getDay();
                
                const sampleMenus = [
                    {
                        title: "Schnitzel Wiener Art",
                        description: "Paniertes Kalbsschnitzel mit Pommes frites und Salat",
                        price: "CHF 16.50",
                        category: "Hit"
                    },
                    {
                        title: "Pasta Arrabbiata",
                        description: "Penne mit scharfer Tomatensauce, Knoblauch und Chili",
                        price: "CHF 13.90",
                        category: "Vegi"
                    },
                    {
                        title: "Grillierter Lachs",
                        description: "Mit Kr√§uterbutter, Reis und Gem√ºse der Saison",
                        price: "CHF 18.50",
                        category: "Menu"
                    },
                    {
                        title: "Caesar Salad",
                        description: "R√∂mersalat mit H√§hnchenbrust, Parmesan und Croutons",
                        price: "CHF 12.50",
                        category: "Menu"
                    },
                    {
                        title: "Schweinsrahmschnitzel",
                        description: "an Champignonssauce, Teigwaren, Tagessalat",
                        price: "CHF 14.80",
                        category: "Hit"
                    }
                ];

                // Return 2-4 items based on day of week
                const numItems = 2 + (dayOfWeek % 3); // 2-4 items
                const startIndex = dayOfWeek % sampleMenus.length;
                
                const result = [];
                for (let i = 0; i < numItems; i++) {
                    result.push(sampleMenus[(startIndex + i) % sampleMenus.length]);
                }
                
                return result;
            }

            renderMenu(menuData) {
                const content = document.getElementById('content');
                
                if (!Array.isArray(menuData)) {
                    menuData = [menuData];
                }

                // Handle edge cases - ensure we have at least 1 item
                if (menuData.length === 0) {
                    menuData = this.createSampleMenu().slice(0, 2);
                }

                const menuHTML = `
                    <div class="menu-grid">
                        ${menuData.map(item => `
                            <div class="menu-card">
                                <div class="menu-category">${item.category || 'Gericht'}</div>
                                <h3 class="menu-title">${item.title || item.name || 'Unbekanntes Gericht'}</h3>
                                <p class="menu-description">${item.description || item.ingredients || 'Keine Beschreibung verf√ºgbar'}</p>
                                <div class="menu-price">${item.price || item.cost || 'Preis auf Anfrage'}</div>
                            </div>
                        `).join('')}
                    </div>
                `;

                content.innerHTML = menuHTML;
            }

            showError(message) {
                const content = document.getElementById('content');
                content.innerHTML = `
                    <div class="error">
                        <strong>‚ö†Ô∏è ${message}</strong>
                        <p>Bitte versuchen Sie es sp√§ter erneut.</p>
                    </div>
                `;
            }

            setupPWA() {
                // Service Worker registration
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.register('/sw.js')
                        .then(registration => console.log('SW registered'))
                        .catch(error => console.log('SW registration failed'));
                }

                // Install prompt
                let deferredPrompt;
                const installPrompt = document.getElementById('installPrompt');
                const installBtn = document.getElementById('installBtn');
                const dismissBtn = document.getElementById('dismissBtn');

                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    deferredPrompt = e;
                    installPrompt.style.display = 'flex';
                });

                installBtn.addEventListener('click', async () => {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        const { outcome } = await deferredPrompt.userChoice;
                        deferredPrompt = null;
                        installPrompt.style.display = 'none';
                    }
                });

                dismissBtn.addEventListener('click', () => {
                    installPrompt.style.display = 'none';
                });
            }
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            new Lunchinator();
        });
    </script>
</body>
</html>